(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1488:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>Q});var a=l(5155),r=l(2115);let s={layout:[["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","floor","floor","floor","wall","floor","floor","floor","floor","floor","floor","floor","wall","floor","floor","floor","floor","floor","wall"],["wall","floor","wall","floor","wall","floor","wall","wall","floor","wall","floor","wall","wall","floor","wall","wall","wall","floor","wall"],["wall","floor","wall","floor","floor","floor","floor","wall","floor","floor","floor","floor","wall","floor","floor","floor","floor","floor","wall"],["wall","floor","wall","wall","wall","floor","wall","wall","wall","wall","floor","wall","wall","wall","wall","floor","wall","wall","wall"],["wall","floor","floor","floor","wall","floor","floor","floor","floor","wall","floor","floor","wall","floor","floor","floor","floor","floor","wall"],["wall","wall","wall","floor","wall","wall","wall","wall","floor","wall","wall","floor","wall","floor","wall","wall","wall","floor","wall"],["wall","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","wall"],["wall","floor","wall","wall","wall","wall","wall","wall","wall","wall","wall","floor","wall","wall","wall","floor","wall","floor","wall"],["wall","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","floor","wall","floor","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"]],notes:[{id:1,position:{x:3,y:3},title:"Первый отголосок",content:"С днем рождения. Этот лабиринт — отражение твоей души. Не бойся его. Каждый коридор — это возможность узнать себя лучше, каждая найденная записка — подарок от твоего прошлого я"},{id:2,position:{x:10,y:3},title:"Шепот прошлого",content:"Тени, которых ты встречаешь — это не враги. Это заблудившиеся воспоминания. Поговори с ними, подбодри их, и они покажут тебе путь. Твоя доброта — ключ к выходу"},{id:3,position:{x:7,y:7},title:"Напоминание",content:"Помнишь, как в детстве ты мечтала о приключениях в свой день рождения? Это одно из них. Каждый шаг здесь наполнен магией твоего праздника. Наслаждайся моментом"},{id:4,position:{x:1,y:9},title:"Письмо от друга",content:"С Днем Рождения! Я знал, что ты пройдешь этот путь. Это путешествие — мой подарок тебе. Путь к самомой себе. Остался последний шаг. Найди Хранителя, и твоя награда ждет тебя."},{id:5,position:{x:17,y:9},title:"Секрет Хранителя",content:"Хранитель — это не страж тьмы, а защитник твоих самых светлых воспоминаний. Он просто хочет убедиться, что ты готова их принять. Покажи ему свою решимость и доброе сердце"},{id:6,position:{x:17,y:1},title:"Забытый подарок",content:"В детстве ты верила, что в день рождения случаются чудеса. И ты была права. Это место — доказательство. Продолжай идти и главное чудо будет ждать тебя впереди."},{id:7,position:{x:13,y:7},title:"Осколок зеркала",content:"Ты видишь в отражении свет своей прекрасной улыбки. Сила, которая ведет тебя — это твоя любовь к жизни. Не сомневайся в себе. Ты главный герой этого приключения"}],enemies:[{id:1,name:"Робкая Тень",position:{x:5,y:1},hp:3,maxHp:3,damage:1,attackPattern:"shadow",dialogue:{check:"* Робкая Тень - УР 1, АТК 1, ЗАЩ 1. \n* Она выглядит немного напуганной. Кажется, она не хочет драться.",talk:"* Ты говоришь тени несколько ободряющих слов. Она с любопытством смотрит на тебя.",attack:"* Робкая Тень неловко бросает в тебя сгустки тьмы.",spare:"* Ты улыбаешься тени. Она радостно машет тебе и исчезает.",defeat:"* Тень благодарно кивает тебе и растворяется в свете. Ты помогла ей найти покой."}},{id:2,name:"Забытое Эхо",position:{x:8,y:5},hp:4,maxHp:4,damage:1,attackPattern:"echo",dialogue:{check:"* Забытое Эхо - УР 1, АТК 1, ЗАЩ 2. \n* Оно тихо напевает какую-то мелодию. Кажется, оно очень одиноко.",talk:"* Ты начинаешь напевать вместе с ним. Эхо выглядит удивленным и счастливым.",attack:"* Эхо атакует звуковыми волнами, которые похожи на грустную песню.",spare:"* Ты даришь Эху свое тепло. Оно растворяется, оставляя после себя чувство легкой ностальгии.",defeat:"* Эхо находит свою мелодию. Воспоминание обрело гармонию благодаря тебе."}},{id:3,name:"Робкая Тень",position:{x:3,y:8},hp:3,maxHp:3,damage:1,attackPattern:"shadow",dialogue:{check:"* Робкая Тень - УР 1, АТК 1, ЗАЩ 1. \n* Еще одно воспоминание. Оно сжимается от страха",talk:"* Твои слова успокаивают тень. Она перестает дрожать.",attack:"* Робкая Тень пытается защититься",spare:"* Твоя доброта помогает тени найти покой. Она исчезает",defeat:"* Ты протягиваешь руку, и тень доверчиво касается ее, прежде чем исчезнуть. Еще один страх развеян"}},{id:4,name:"Хранитель Воспоминаний",position:{x:17,y:8},hp:10,maxHp:10,isBoss:!0,damage:3,attackPattern:"guardian",dialogue:{check:"* Хранитель Воспоминаний - УР ??, АТК ??, ЗАЩ ??. \n* Он страж твоих самых дорогих моментов. Он хочет проверить, достойна ли ты их.",talk:"* Ты говоришь Хранителю, что готова принять свое прошлое. Он кивает, но его взгляд остается серьезным.",attack:"* Хранитель устраивает тебе испытание!",spare:"* Ты показываешь Хранителю свою решимость. Он видит твою доброту и уступает дорогу.",defeat:"* Хранитель склоняет голову. Ты доказала, что готова принять свой дар. Путь открыт."}},{id:5,name:"Забытое Эхо",position:{x:15,y:3},hp:4,maxHp:4,damage:1,attackPattern:"echo",dialogue:{check:"* Забытое Эхо - УР 1, АТК 1, ЗАЩ 2. \n* Оно выглядит потерянным. Ему нужна помощь.",talk:"* Ты рассказываешь Эху, что оно не одно. Кажется, это помогает. Оно выглядит спокойнее.",attack:"* Эхо плачет светлыми слезами, которые превращаются в пули.",spare:"* Ты обнимаешь Эхо, и оно исчезает с благодарностью.",defeat:"* Печальная мелодия сменяется радостной. Ты помогла этому воспоминанию снова зазвучать"}},{id:6,name:"Робкая Тень",position:{x:14,y:9},hp:3,maxHp:3,damage:1,attackPattern:"shadow",dialogue:{check:"* Робкая Тень - УР 1, АТК 1, ЗАЩ 1. \n* Она боится сделать первый шаг.",talk:"* Ты говоришь, что веришь в нее. Тень колеблется. Может это сработает?",attack:"* Тень пытается быть храброй и атакует",spare:"* Твоя уверенность вдохновляет Тень. Она улыбается и исчезает.",defeat:"* Тень расправляет плечи и уверенно шагает в свет. Ты вселила в нее храбрость."}}],playerStart:{x:1,y:1}};var n=l(4253),o=l(2085),i=l(9434);let c=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:l,variant:r,size:s,asChild:o=!1,...d}=e,f=o?n.DX:"button";return(0,a.jsx)(f,{className:(0,i.cn)(c({variant:r,size:s,className:l})),ref:t,...d})});d.displayName="Button";let f=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",l),...r})});f.displayName="Card";let u=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",l),...r})});u.displayName="CardHeader";let x=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",l),...r})});x.displayName="CardTitle";let m=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",l),...r})});m.displayName="CardDescription";let h=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",l),...r})});h.displayName="CardContent";let w=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",l),...r})});w.displayName="CardFooter";var p=l(4601);function v(e){let{onStart:t}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsxs)(f,{className:"w-full max-w-md shadow-lg shadow-primary/10",children:[(0,a.jsxs)(u,{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto bg-primary/20 p-3 rounded-full mb-4 w-fit",children:(0,a.jsx)(p.A,{className:"h-8 w-8 text-primary"})}),(0,a.jsx)(x,{className:"font-headline text-3xl"}),(0,a.jsx)(m,{className:"text-muted-foreground",children:"Сегодня твой день рождения! Приготовься отправиться в путешествие по чертогам своей памяти"})]}),(0,a.jsx)(h,{children:(0,a.jsx)(d,{onClick:t,className:"w-full text-lg py-6",children:"Начать"})})]})})}var y=l(203),g=l(2543),j=l(3926),N=l(9968),b=l(5007),k=l(7545),C=l(8044),M=l(5731);function A(e){let{map:t,playerPosition:l,discoveredNotes:r,defeatedEnemies:s}=e;return(0,a.jsx)("div",{className:"bg-card p-2 sm:p-4 rounded-md border border-border",children:(0,a.jsx)("div",{className:"grid grid-cols-19 gap-0.5",children:t.layout.map((e,n)=>e.map((e,o)=>{let c=l.x===o&&l.y===n,d=t.notes.find(e=>e.position.x===o&&e.position.y===n),f=!!d&&r.has(d.id),u=t.enemies.find(e=>e.position.x===o&&e.position.y===n),x=!!u&&s.has(u.id);return(0,a.jsxs)("div",{className:(0,i.cn)("tile","wall"===e?"tile-wall":"tile-floor","flex items-center justify-center relative"),children:[d&&(0,a.jsx)(k.A,{className:(0,i.cn)("w-5 h-5 text-yellow-300 absolute",f?"note-read":"note-pulse")}),u&&!x&&(0,a.jsx)("div",{className:"enemy absolute",children:u.isBoss?(0,a.jsx)(C.A,{className:"w-6 h-6 text-destructive animate-pulse"}):(0,a.jsx)(M.A,{className:"w-5 h-5 text-destructive animate-ghostly"})}),c&&(0,a.jsx)("div",{className:"player relative"})]},"".concat(o,"-").concat(n))}))})})}function E(e){let{map:t,playerPosition:l,discoveredNotes:r,defeatedEnemies:s,onFinish:n,allNotesDiscovered:o,onMove:i}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(f,{className:"w-full shadow-lg border-primary/20",children:[(0,a.jsxs)(u,{children:[(0,a.jsx)(x,{className:"font-headline text-4xl text-primary",children:"Залы Воспоминаний"}),(0,a.jsx)(m,{className:"text-lg italic",children:"Воспоминания ждут."})]}),(0,a.jsxs)(h,{className:"flex flex-col items-center justify-center gap-4",children:[(0,a.jsx)(A,{map:t,playerPosition:l,discoveredNotes:r,defeatedEnemies:s}),(0,a.jsxs)("div",{className:"md:hidden flex flex-col items-center gap-2 mt-4",children:[(0,a.jsx)(d,{onClick:()=>i(0,-1),size:"icon",children:(0,a.jsx)(y.A,{})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d,{onClick:()=>i(-1,0),size:"icon",children:(0,a.jsx)(g.A,{})}),(0,a.jsx)(d,{onClick:()=>i(0,1),size:"icon",children:(0,a.jsx)(j.A,{})}),(0,a.jsx)(d,{onClick:()=>i(1,0),size:"icon",children:(0,a.jsx)(N.A,{})})]})]})]}),o&&(0,a.jsx)(w,{children:(0,a.jsxs)(d,{onClick:n,className:"w-full text-lg py-6 animate-pulse",children:[(0,a.jsx)(b.A,{className:"mr-2"}),"Получить свой дар"]})})]})})}function I(e){let{className:t,...l}=e;return(0,a.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",t),...l})}var S=l(2160);function T(e){let{playerName:t}=e,[l,s]=(0,r.useState)(!0),[n,o]=(0,r.useState)(""),[i,c]=(0,r.useState)("");return(0,r.useEffect)(()=>{try{o("С днем рождения, Лиза!\n\nИтак, я не слишком знаю что говорить.\n Поздравляю тебя, желаю оставаться такой же умной, милой и классной)".replace("${playerName}",t))}catch(e){c("Произошла ошибка при загрузке послания.")}finally{s(!1)}},[t]),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsxs)(f,{className:"w-full max-w-2xl text-center shadow-lg shadow-primary/20",children:[(0,a.jsxs)(u,{children:[(0,a.jsx)("div",{className:"mx-auto bg-primary/20 p-4 rounded-full mb-4 w-fit",children:(0,a.jsx)(S.A,{className:"h-10 w-10 text-primary"})}),(0,a.jsx)(x,{className:"font-headline text-3xl",children:"Твой дар"}),(0,a.jsxs)(m,{children:["С днем рождения, ",t,"! Путешествие завершено, и свет приносит тебе это послание."]})]}),(0,a.jsx)(h,{className:"min-h-[120px]",children:l?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I,{className:"h-4 w-full"}),(0,a.jsx)(I,{className:"h-4 w-full"}),(0,a.jsx)(I,{className:"h-4 w-3/4"})]}):i?(0,a.jsx)("p",{className:"text-destructive",children:i}):(0,a.jsx)("p",{className:"text-lg italic text-foreground/90 whitespace-pre-wrap",children:n})})]})})}var z=l(9320),R=l(4063),P=l(9274),O=l(8098);let L=0;function _(e){let{onPlayerDamaged:t,damage:l,attackPattern:s}=e,[n,o]=(0,r.useState)({x:92,y:92}),[c,d]=(0,r.useState)([]),[f,u]=(0,r.useState)(!1),x=(0,r.useRef)({}),m=(0,r.useRef)(null),h=(0,r.useRef)(0),w=(0,r.useRef)(),p=(0,r.useRef)(0),v=(0,r.useCallback)(e=>{let t="bullet-".concat(Date.now(),"-").concat(L++);d(l=>[...l,{...e,id:t}])},[]),y={shadow:[()=>{let e=setInterval(()=>{v({x:200*Math.random(),y:-10,vx:(Math.random()-.5)*2,vy:2+Math.random(),size:8})},300);return()=>clearInterval(e)},()=>{let e=!0,t=setInterval(()=>{for(let t=0;t<5;t++)v({x:e?-10:210,y:200*t/4+(20*Math.random()-10),vx:e?2.5:-2.5,vy:0,size:10});e=!e},1e3);return()=>clearInterval(t)}],echo:[()=>{let e=Math.random()*Math.PI*2,t=setInterval(()=>{e+=.8;for(let t=0;t<2;t++)v({x:100,y:100,vx:2*Math.cos(e+t*Math.PI),vy:2*Math.sin(e+t*Math.PI),size:7})},100);return()=>clearInterval(t)},()=>{let e=setInterval(()=>{let e=n.x;for(let t=0;t<3;t++)setTimeout(()=>{v({x:e+(40*Math.random()-20),y:-10,vx:0,vy:3,size:9})},150*t)},1e3);return()=>clearInterval(e)}],guardian:[()=>{let e=setInterval(()=>{let e=Math.PI/8;for(let t=0;t<16;t++){let l=t*e;v({x:100,y:100,vx:3.5*Math.cos(l),vy:3.5*Math.sin(l),size:6})}},900);return()=>clearInterval(e)},()=>{let e=setInterval(()=>{v({x:Math.random()>.5?-10:210,y:200*Math.random(),vx:0,vy:0,size:12,update:e=>{let t=n.x-e.x,l=Math.atan2(n.y-e.y,t);return{...e,vx:1.5*Math.cos(l),vy:1.5*Math.sin(l)}}})},1200);return()=>clearInterval(e)},()=>{let e=setInterval(()=>{let e=Math.random()>.5,t=200*Math.random();for(let l=0;l<20;l++)v({x:e?t:10*l,y:e?10*l:t,vx:0,vy:0,size:10})},1500);return()=>clearInterval(e)},()=>{let e=0,t=setInterval(()=>{v({x:100,y:100,vx:2.5*Math.cos(e+=.5),vy:2.5*Math.sin(e),size:8})},50);return()=>clearInterval(t)},()=>{let e=setInterval(()=>{let e=n.x,t=n.y;for(let l=0;l<5;l++)setTimeout(()=>{let l=Math.atan2(t-100,e-100)+(Math.random()-.5)*.4;v({x:100,y:100,vx:4*Math.cos(l),vy:4*Math.sin(l),size:7})},80*l)},1e3);return()=>clearInterval(e)},()=>{let e=0,t=setInterval(()=>{v({x:100+80*Math.sin(.1*++e),y:-10,vx:0,vy:3,size:10}),v({x:210,y:100+80*Math.cos(.1*e),vx:-3,vy:0,size:10})},100);return()=>clearInterval(t)}]};return(0,r.useEffect)(()=>{let e=setInterval(()=>{p.current++,o(e=>{let{x:t,y:l}=e;return(x.current.arrowup||x.current.w||x.current["ц"])&&(l-=4),(x.current.arrowdown||x.current.s||x.current["ы"])&&(l+=4),(x.current.arrowleft||x.current.a||x.current["ф"])&&(t-=4),(x.current.arrowright||x.current.d||x.current["в"])&&(t+=4),{x:t=Math.max(0,Math.min(t,184)),y:l=Math.max(0,Math.min(l,184))}}),d(e=>e.map(e=>{let t=e.update?e.update(e,p.current):e;return{...t,x:t.x+t.vx,y:t.y+t.vy}}).filter(e=>e.x>-e.size-20&&e.x<200+e.size+20&&e.y>-e.size-20&&e.y<200+e.size+20));let e=Date.now();if(e-h.current>1500)for(let a of(f&&u(!1),c)){let r=n.x+8-(a.x+a.size/2),s=n.y+8-(a.y+a.size/2);if(Math.sqrt(r*r+s*s)<8+a.size/2){t(l),u(!0),h.current=e;break}}},1e3/60);return()=>clearInterval(e)},[c,n,t,f,l]),(0,r.useEffect)(()=>{let e=e=>{x.current[e.key.toLowerCase()]=!0},t=e=>{x.current[e.key.toLowerCase()]=!1};window.addEventListener("keydown",e),window.addEventListener("keyup",t);let l=y[s]||y.shadow,a=null,r=()=>{a&&a(),a=(0,l[Math.floor(Math.random()*l.length)])()};return r(),w.current=setInterval(r,"guardian"===s?4e3:5e3),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t),w.current&&clearInterval(w.current),a&&a()}},[s,v]),(0,a.jsxs)("div",{ref:m,className:"relative bg-black border-2 border-white mx-auto overflow-hidden",style:{width:200,height:200},children:[(0,a.jsx)("div",{className:(0,i.cn)("player-soul",f&&"animate-flicker"),style:{left:"".concat(n.x,"px"),top:"".concat(n.y,"px"),width:"".concat(16,"px"),height:"".concat(16,"px")},children:(0,a.jsx)(O.A,{className:"w-full h-full text-red-500 fill-current"})}),c.map(e=>(0,a.jsx)("div",{className:"bullet",style:{left:"".concat(e.x,"px"),top:"".concat(e.y,"px"),width:"".concat(e.size,"px"),height:"".concat(e.size,"px")}},e.id))]})}let H="font-code text-yellow-400 text-2xl hover:bg-yellow-400/20 hover:text-yellow-300 focus:text-yellow-300 focus:bg-yellow-400/20 w-32 h-12 flex items-center justify-start gap-4 px-4";function Y(e){let{enemy:t,onBattleEnd:l,onPlayerDamaged:s,playerHealth:n,maxPlayerHealth:o}=e,[c,u]=(0,r.useState)("CHOOSING"),[x,m]=(0,r.useState)(""),[w,p]=(0,r.useState)(!1),[v,y]=(0,r.useState)(t.hp),[g,j]=(0,r.useState)(!1),N=(0,r.useRef)(null),b=(0,r.useRef)(null),k=(0,r.useRef)(),M=()=>m("* ".concat(t.name," смотрит на тебя с любопытством."));(0,r.useEffect)(()=>{var e;null==(e=N.current)||e.focus()},[]),(0,r.useEffect)(()=>(y(t.hp),u("CHOOSING"),m("* ".concat(t.name," появляется перед тобой.")),p(!1),j(!1),()=>{k.current&&clearTimeout(k.current)}),[t]);let A=()=>{u("CHOOSING_ACT"),m("* Что же делать?")},E=()=>{m(t.dialogue.check),p(!0),u("DIALOGUE"),k.current=setTimeout(()=>D(),4e3)},I=()=>{k.current&&clearTimeout(k.current),m(""),u("PLAYER_ATTACK"),k.current=setTimeout(()=>S(0),4e3)},S=e=>{if(k.current&&clearTimeout(k.current),"PLAYER_ATTACK"!==c&&"CHOOSING"!==c)return;let a=Math.max(0,v-e);e>0&&j(!0),y(a),a<=0?(u("BATTLE_VICTORY"),m(t.dialogue.defeat),k.current=setTimeout(()=>{l(!0)},3e3)):(m(e>0?"* Ты наносишь ".concat(e," урона!"):"* Ты промахиваешься."),k.current=setTimeout(()=>{j(!1),D()},1500))},T=()=>{if(!b.current||"PLAYER_ATTACK"!==c)return;let e=b.current,t=e.firstElementChild;if(!t)return void S(0);let l=new WebKitCSSMatrix(window.getComputedStyle(t).transform).m41;t.style.animationPlayState="paused";let a=e.offsetWidth,r=Math.abs(a/2-(l+t.offsetWidth/2)),s=0;r<.05*a?s=3:r<.4*a&&(s=Math.max(1,Math.round(2*(1-r/(a/2))))),S(s)},O=()=>{m(t.dialogue.talk),p(!0),u("DIALOGUE"),k.current=setTimeout(()=>D(),4e3)},L=()=>{u("MERCY"),m("* Твоё милосердие - твоя сила.")},Y=()=>{w?(m(t.dialogue.spare),k.current=setTimeout(()=>l(!0),2e3)):(m("* ".concat(t.name," пока не готов к пощаде.")),u("DIALOGUE"),k.current=setTimeout(()=>D(),2e3))},D=()=>{u("ENEMY_TURN"),m("* ".concat(t.dialogue.attack)),k.current=setTimeout(()=>{u("CHOOSING"),M()},t.isBoss?8e3:5e3)};return(0,a.jsxs)("div",{ref:N,className:"flex flex-col items-center justify-center min-h-[80vh] bg-black text-white p-4 font-code outline-none",tabIndex:-1,onKeyDown:e=>{"PLAYER_ATTACK"===c&&(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),T())},children:[(0,a.jsxs)("div",{className:"w-full max-w-2xl text-center mb-4 h-24 flex flex-col items-center justify-center",children:["ENEMY_TURN"!==c&&(0,a.jsx)("div",{className:(0,i.cn)("transition-transform duration-75",g&&"animate-ping-once"),children:(0,a.jsx)(C.A,{className:(0,i.cn)("h-20 w-20 text-white mx-auto transition-transform duration-500 ease-in-out",g?"scale-110 -rotate-6":"scale-100","animate-ghostly")})}),(0,a.jsxs)("div",{className:"w-1/2 mt-2",children:[(0,a.jsx)("div",{className:"text-left text-lg",children:t.name}),(0,a.jsx)("div",{className:"w-full h-3 bg-green-900 border border-white flex items-center justify-start",children:(0,a.jsx)("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:"".concat(v/t.maxHp*100,"%")}})})]})]}),(0,a.jsx)(f,{className:"w-full max-w-2xl h-64 bg-black border-2 border-white mb-4 flex items-center justify-center p-4",children:(0,a.jsx)(h,{className:"w-full h-full p-0",children:"ENEMY_TURN"===c?(0,a.jsx)(_,{onPlayerDamaged:s,damage:t.damage,attackPattern:t.attackPattern}):"PLAYER_ATTACK"===c?(0,a.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center gap-4",children:[(0,a.jsxs)("div",{ref:b,className:"h-4 w-4/5 bg-gray-700 relative overflow-hidden rounded-full border border-white",children:[(0,a.jsx)("div",{className:"animate-attack-bar absolute top-0 h-full w-2 bg-yellow-400"}),(0,a.jsx)("div",{className:"absolute top-0 h-full bg-primary",style:{left:"calc(50% - 5%)",width:"10%"}})]}),(0,a.jsx)(d,{onClick:T,className:"font-code text-xl",children:"Удар!"})]}):(0,a.jsx)("div",{className:"flex items-start justify-start h-full text-left",children:(0,a.jsx)("p",{className:"text-2xl whitespace-pre-wrap",children:x})})})}),(0,a.jsx)("div",{className:"w-full max-w-2xl flex justify-around items-center h-16",children:(()=>{switch(c){case"CHOOSING_ACT":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{variant:"ghost",className:H,onClick:E,children:(0,a.jsx)("p",{className:"text-white",children:"* Проверить"})}),(0,a.jsx)(d,{variant:"ghost",className:H,onClick:O,children:(0,a.jsx)("p",{className:"text-white",children:"* Говорить"})}),(0,a.jsx)(d,{variant:"ghost",className:H,onClick:()=>{u("CHOOSING"),M()},children:(0,a.jsx)("p",{className:"text-white",children:"* Назад"})})]});case"MERCY":return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{variant:"ghost",className:H,onClick:Y,children:(0,a.jsx)("p",{className:w?"text-yellow-300":"text-gray-500",children:"* Щадить"})}),(0,a.jsx)(d,{variant:"ghost",className:H,onClick:()=>l(!1),children:(0,a.jsx)("p",{className:"text-white",children:"* Сбежать"})}),(0,a.jsx)(d,{variant:"ghost",className:H,onClick:()=>{u("CHOOSING"),M()},children:(0,a.jsx)("p",{className:"text-white",children:"* Назад"})})]});case"DIALOGUE":case"ENEMY_TURN":case"PLAYER_ATTACK":case"BATTLE_VICTORY":return null;default:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d,{variant:"ghost",className:H,onClick:I,children:[(0,a.jsx)(z.A,{className:"mr-2"})," Атака"]}),(0,a.jsxs)(d,{variant:"ghost",className:H,onClick:A,children:[(0,a.jsx)(R.A,{className:"mr-2"})," Действие"]}),(0,a.jsxs)(d,{variant:"ghost",className:H,onClick:L,children:[(0,a.jsx)(P.A,{className:"mr-2"})," Пощада"]})]})}})()}),(0,a.jsxs)("div",{className:"w-full max-w-2xl flex justify-between items-center text-xl mt-4 px-4",children:[(0,a.jsx)("span",{children:"Лиза"}),(0,a.jsx)("span",{children:"УР 1"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:"HP"}),(0,a.jsx)("div",{className:"w-24 h-6 bg-red-900 border-2 border-white flex items-center justify-start",children:(0,a.jsx)("div",{className:"h-full bg-yellow-400",style:{width:"".concat(n/o*100,"%")}})}),(0,a.jsxs)("span",{children:[n," / ",o]})]})]})]})}var D=l(2643);function G(e){let{onRestart:t}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsxs)(f,{className:"w-full max-w-md shadow-lg shadow-destructive/20 text-center",children:[(0,a.jsxs)(u,{children:[(0,a.jsx)("div",{className:"mx-auto bg-destructive/20 p-4 rounded-full mb-4 w-fit",children:(0,a.jsx)(D.A,{className:"h-10 w-10 text-destructive"})}),(0,a.jsx)(x,{className:"font-headline text-3xl text-destructive",children:"Ты проиграла"}),(0,a.jsx)(m,{className:"text-muted-foreground",children:"Твоя решимость позволяет тебе попробовать еще раз."})]}),(0,a.jsx)(h,{children:(0,a.jsx)(d,{onClick:t,variant:"destructive",className:"w-full text-lg py-6",children:"Начать заново"})})]})})}var U=l(7003),K=l(5318);let B=U.bL;U.l9;let F=U.ZL;U.bm;let V=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)(U.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",l),...r})});V.displayName=U.hJ.displayName;let W=r.forwardRef((e,t)=>{let{className:l,children:r,...s}=e;return(0,a.jsxs)(F,{children:[(0,a.jsx)(V,{}),(0,a.jsxs)(U.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",l),...s,children:[r,(0,a.jsxs)(U.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(K.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});W.displayName=U.UC.displayName;let J=e=>{let{className:t,...l}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...l})};J.displayName="DialogHeader";let $=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)(U.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",l),...r})});$.displayName=U.hE.displayName;let q=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,a.jsx)(U.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",l),...r})});function Q(){let[e,t]=(0,r.useState)("intro"),[l,n]=(0,r.useState)("Лиза"),[o,i]=(0,r.useState)(new Set),[c,d]=(0,r.useState)(null),[f,u]=(0,r.useState)(null),[x,m]=(0,r.useState)(new Set),[h,w]=(0,r.useState)(s.playerStart),[p,y]=(0,r.useState)(20),[g]=(0,r.useState)(20),j=()=>{t("intro"),n("Лиза"),i(new Set),d(null),u(null),m(new Set),w(s.playerStart),y(g)},N=()=>{t("playing")},b=(0,r.useCallback)(e=>{o.has(e)||(i(t=>new Set(t).add(e)),d(s.notes.find(t=>t.id===e)||null))},[o]),k=(0,r.useCallback)(e=>{x.has(e.id)||(u(e),t("battle"))},[x]),C=()=>{t("finished")},M=(0,r.useCallback)(e=>{y(l=>{let a=Math.max(0,l-e);return a<=0&&t("gameover"),a})},[]),A=(0,r.useCallback)(e=>{e&&f&&m(e=>new Set(e).add(f.id)),y(g),t("playing"),u(null)},[f,g]),I=(0,r.useCallback)((e,t)=>{let l=h.x+e,a=h.y+t;if(a>=0&&a<s.layout.length&&l>=0&&l<s.layout[a].length&&"wall"!==s.layout[a][l]){w({x:l,y:a});let e=s.notes.find(e=>e.position.x===l&&e.position.y===a);e&&b(e.id);let t=s.enemies.find(e=>e.position.x===l&&e.position.y===a);t&&!x.has(t.id)&&k(t)}},[h,b,k,x]);(0,r.useEffect)(()=>{let t=t=>{if("playing"===e)switch(t.preventDefault(),t.key.toLowerCase()){case"arrowup":case"w":case"ц":I(0,-1);break;case"arrowdown":case"s":case"ы":I(0,1);break;case"arrowleft":case"a":case"ф":I(-1,0);break;case"arrowright":case"d":case"в":I(1,0)}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e,I]);let S=(0,r.useMemo)(()=>Math.round(o.size/s.notes.length*100),[o]),z=(0,r.useMemo)(()=>o.size===s.notes.length,[o]);return(0,a.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 sm:p-8 md:p-12 bg-background",children:[(0,a.jsx)("div",{className:"w-full max-w-4xl mx-auto",children:(()=>{switch(e){case"intro":return(0,a.jsx)(v,{onStart:N});case"playing":return(0,a.jsx)(E,{map:s,playerPosition:h,discoveredNotes:o,defeatedEnemies:x,onFinish:C,allNotesDiscovered:z,onMove:I});case"battle":if(!f)return null;return(0,a.jsx)(Y,{enemy:f,onBattleEnd:A,onPlayerDamaged:M,playerHealth:p,maxPlayerHealth:g});case"finished":return(0,a.jsx)(T,{playerName:l,explorationProgress:S,discoveredSecrets:o.size});case"gameover":return(0,a.jsx)(G,{onRestart:j});default:return null}})()}),(0,a.jsx)(B,{open:!!c,onOpenChange:()=>d(null),children:(0,a.jsx)(W,{children:(0,a.jsxs)(J,{children:[(0,a.jsx)($,{className:"text-primary font-headline text-2xl",children:null==c?void 0:c.title}),(0,a.jsx)(q,{className:"text-base pt-4 whitespace-pre-wrap",children:null==c?void 0:c.content})]})})})]})}q.displayName=U.VY.displayName},7031:(e,t,l)=>{Promise.resolve().then(l.bind(l,1488))},9434:(e,t,l)=>{"use strict";l.d(t,{cn:()=>s});var a=l(2596),r=l(9688);function s(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];return(0,r.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[802,407,441,684,358],()=>t(7031)),_N_E=e.O()}]);